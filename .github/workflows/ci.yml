name: SAST & SCA check

on: [ push, pull_request ]

#permissions:
#  contents: read
jobs:
  java-sast:
    name: Java SAST (SpotBugs)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '21'

      - name: SpotBugs via Maven
        run: |
          mvn -B -DskipTests install
          echo ${{ secrets.NVD_API_KEY }}
          mvn -B -DskipTests -DnvdApiKey=${{ secrets.NVD_API_KEY }} spotbugs:spotbugs || true

  sca-owasp:
    name: SCA (OWASP Dependency-Check)
    runs-on: ubuntu-latest
    env:
      NVD_API_KEY: ${{ secrets.NVD_API_KEY }}
    steps:
      - uses: actions/checkout@v4

      - name: run OWASP Dependency-Check
        run: |
          curl -sLo dc.zip https://github.com/jeremylong/DependencyCheck/releases/download/v10.0.3/dependency-check-10.0.3-release.zip
          unzip -q dc.zip -d $HOME/dc
          $HOME/dc/dependency-check/bin/dependency-check.sh \
            --project "repo-${{ github.repository }}" \
            --scan . \
            --format "JSON" \
            --out dependency-check-report || true \
            --nvdApiKey "$NVD_API_KEY" || true

      - name: Upload Dependency-Check report
        uses: actions/upload-artifact@v4
        with:
          name: owasp-dependency-check-report
          path: dependency-check-report
          if-no-files-found: ignore

